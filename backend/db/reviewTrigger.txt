CREATE OR REPLACE TRIGGER REVIEW_TRIGGER  
AFTER INSERT  
ON REVIEW 
FOR EACH ROW
DECLARE
    AVG_RATING NUMBER;
BEGIN

SELECT AVG(RATINGVALUE) INTO AVG_RATING
FROM REVIEW
WHERE PRODUCTID = :NEW.PRODUCTID;

UPDATE PRODUCT
SET AVERAGERATING = AVG_RATING
WHERE PRODUCTID = :NEW.PRODUCTID;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RAISE_APPLICATION_ERROR(-20001, 'Product not found for ProductID = ' || :NEW.ProductID);
    WHEN OTHERS THEN
        RAISE_APPLICATION_ERROR(-20002, 'Trigger failed: ' || SQLERRM);
END;