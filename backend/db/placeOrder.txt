CREATE OR REPLACE PROCEDURE PLACE_ORDER (
    p_customer_id IN NUMBER,
    p_product_id  IN NUMBER,
    p_quantity    IN NUMBER,
    p_price       IN NUMBER,
    p_order_id    OUT NUMBER
)
AS
    v_total_price NUMBER := p_quantity * p_price;
BEGIN
    -- Insert into PRODUCTORDER and return ORDERID
    INSERT INTO PRODUCTORDER (CUSTOMERID, SUBTOTAL, STATUS, TOTAL)
    VALUES (p_customer_id, v_total_price, 'n', v_total_price)
    RETURNING ORDERID INTO p_order_id;

    -- Insert into ORDERITEM using returned ORDERID
    INSERT INTO ORDERITEM (ORDERID, PRODUCTID, QUANTITY, PRICE, TOTAL)
    VALUES (p_order_id, p_product_id, p_quantity, p_price, v_total_price);

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        RAISE_APPLICATION_ERROR(-20002, 'Trigger failed: ' || SQLERRM);
END;
/
